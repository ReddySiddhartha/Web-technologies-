<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Late Night Ride Module</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 50px;
    }

    .night-section {
      width: 350px;
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      text-align: center;
    }

    .night-section h2 {
      color: #333;
      margin-bottom: 15px;
    }

    .night-section p {
      font-size: 14px;
      color: #555;
      margin: 10px 0 5px;
    }

    input[type="datetime-local"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      width: 100%;
      padding: 10px 0;
      margin: 6px 0;
      font-size: 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      transition: 0.3s;
    }

    button:hover {
      background-color: #0056b3;
    }

    #status {
      margin-top: 15px;
      font-size: 16px;
      font-weight: bold;
    }

    .success { color: green; }
    .warning { color: orange; }
    .error { color: red; }
  </style>
</head>
<body>

<div class="night-section">
  <h2>üåô Late Night Rides</h2>

  <p><strong>Pre-book your ride:</strong></p>
  <input type="datetime-local" id="prebookTime">
  <button onclick="preBook()">üìÖ Pre-book Ride</button>

  <p><strong>Forgot to pre-book?</strong></p>
  <button onclick="requestRide()">üö® Emergency Ride</button>

  <p><strong>Nearby pickups (2‚Äì3 km):</strong></p>
  <button onclick="checkNearbyAuto()">üõ£Ô∏è Check Nearby Autos</button>

  <p><strong>Share your location:</strong></p>
  <button onclick="shareLocation()">üìç Share Location</button>

  <p id="status"></p>
</div>

<script>
  // Simulated list of drivers (status will change randomly)
  let drivers = [
    { name: "Raju", distance: 1.5, status: "available" },
    { name: "Balu", distance: 2.2, status: "available" },
    { name: "Sharan", distance: 2.8, status: "available" }
  ];

  // Pre-book ride
  function preBook() {
    let time = document.getElementById("prebookTime").value;
    let statusEl = document.getElementById("status");

    if (time) {
      statusEl.innerText = "‚úÖ Pre-booked ride at " + new Date(time).toLocaleString();
      statusEl.className = "success";
    } else {
      statusEl.innerText = "‚ö†Ô∏è Please select a time before booking.";
      statusEl.className = "warning";
    }
  }

  // Emergency ride
  function requestRide() {
    const responses = [
      { text: "‚úÖ Auto assigned! Driver Sharan will pick you in 5 mins.", type: "success" },
      { text: "üöó No free autos. You can join another ride leaving in 10 mins.", type: "warning" },
      { text: "‚ùå No autos available. Admin notified. Please wait at safe zone.", type: "error" }
    ];
    const random = responses[Math.floor(Math.random() * responses.length)];

    const statusEl = document.getElementById("status");
    statusEl.innerText = random.text;
    statusEl.className = random.type;
  }

  // Check nearby autos (2‚Äì3 km)
  function checkNearbyAuto() {
    const statusEl = document.getElementById("status");
    const nearby = drivers.filter(d => d.status === "available" && d.distance <= 3);

    if (nearby.length > 0) {
      const list = nearby.map(d => `${d.name} (${d.distance} km)`).join(", ");
      statusEl.innerText = "üõ£Ô∏è Nearby autos available: " + list;
      statusEl.className = "success";
    } else {
      statusEl.innerText = "‚ùå No nearby autos available. Please wait at safe zone.";
      statusEl.className = "error";
    }
  }

  // Share user's location
  function shareLocation() {
    const statusEl = document.getElementById("status");

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const locationLink = `https://www.google.com/maps?q=${lat},${lon}`;

          statusEl.innerHTML = `üìç Your location: ${lat.toFixed(5)}, ${lon.toFixed(5)}<br><a href="${locationLink}" target="_blank">Open in Google Maps</a>`;
          statusEl.className = "success";
        },
        () => {
          statusEl.innerText = "‚ùå Unable to get location. Please allow location access.";
          statusEl.className = "error";
        }
      );
    } else {
      statusEl.innerText = "‚ùå Geolocation is not supported by your browser.";
      statusEl.className = "error";
    }
  }

  // Simulate driver status changing every 5 seconds
  setInterval(() => {
    drivers.forEach(d => {
      d.status = Math.random() > 0.5 ? "available" : "busy";
    });
    checkNearbyAuto(); // auto-refresh status
  }, 5000);
</script>

</body>
</html>
